#!/usr/bin/env python3
from neo4j import GraphDatabase

driver = GraphDatabase.driver(
    "bolt://127.0.0.1:7687",
    auth=("neo4j", "memento_password")
)

def delete_raw_entities(tx):
    # Delete nodes that have the structure you created but aren't proper Memento entities
    query = """
    MATCH (n:Entity)
    WHERE n.version = 1 
    AND n.createdAt IS NOT NULL
    AND n.updatedAt IS NOT NULL
    AND n.validFrom IS NOT NULL
    AND size(n.observations) = 1
    DELETE n
    RETURN count(n) as deleted
    """
    result = tx.run(query)
    return result.single()["deleted"]

with driver.session(database="neo4j") as session:
    deleted = session.execute_write(delete_raw_entities)
    print(f"Deleted {deleted} raw Entity nodes")

driver.close()
